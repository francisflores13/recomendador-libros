<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recomendador de libros</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Fuentes personalizadas (opcional, Tailwind usa buenas fuentes por defecto) */
        /* @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap'); */
        body {
            /* font-family: 'Inter', sans-serif; */
            /* Aplicar degradado de fondo suave */
            background-image: linear-gradient(to bottom right, #fee2e2, #ffffff); /* Degradado de rojo muy claro a blanco */
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-color: #ffffff; /* Color de fallback */
        }

        /* Clases personalizadas para botones */
        .btn-primary {
            /* Bot√≥n principal (Descargar Lista) */
            @apply inline-block bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-semibold py-2 px-4 rounded-md transition duration-150 ease-in-out w-full text-center shadow-md;
        }
        .btn-secondary {
            /* Bot√≥n secundario (Volver, Imprimir, Marcar como Le√≠do) */
             @apply w-full bg-red-200 hover:bg-red-300 text-red-800 font-semibold py-2 px-4 rounded-md transition duration-150 ease-in-out text-center shadow-md;
        }

        /* Estilo para las tarjetas de g√©nero */
        .genre-card {
            /* Aplicamos estilos de tarjeta, sombreado, bordes redondeados y fondo blanco */
            @apply bg-white rounded-lg shadow-md p-6 m-2 cursor-pointer hover:scale-105 transition duration-150 ease-in-out flex flex-col items-center text-center;
            /* Tailwind grid handles width */
            width: 100%;
            cursor: pointer
        }

        /* Estilo para el emoji en las tarjetas de g√©nero */
        .genre-emoji {
            /* Aumentamos el tama√±o del emoji y centramos */
            font-size: 3em; /* Aproximadamente 48px */
            @apply mb-4 flex justify-center items-center;
        }

        /* Estilo para el emoji en las tarjetas de recomendaci√≥n */
        .recommendation-emoji {
            /* Aumentamos el tama√±o del emoji */
            font-size: 2.5em; /* Aproximadamente 40px */
            @apply mb-2 text-center w-full;
        }

        /* Estilo para las tarjetas de recomendaci√≥n */
        .book-card {
            @apply bg-white rounded-lg shadow-lg p-4 flex flex-col items-center text-center; /* Aseguramos centrado */
        }

        /* Estilo para la descripci√≥n del libro */
        .book-description {
            /* Eliminamos l√≠mites de altura y overflow */
            display: block;
            @apply text-gray-700 text-sm mb-4;
            margin-bottom: 15px;
        }


        /* Estilo para la lista de libros le√≠dos */
        .read-list-item {
             @apply bg-gray-100 rounded-md p-3 mb-2 flex justify-between items-center shadow-sm;
        }

        /* Estilo para los botones de acci√≥n en la lista de le√≠dos */
        .read-list-actions button {
             /* Estilo para los botones "Descargar" y "Imprimir" */
             @apply btn-secondary w-auto px-6; /* Usamos el estilo secundario y ajustamos ancho */
        }


        /* Estilo para el contenedor de tarjetas de g√©nero usando grid */
        #genreCardsContainer {
            display: grid;
            /* 2 columnas en m√≥vil por defecto */
            grid-template-columns: 200px repeat(auto-fit, minmax(200px, 1fr)); /* Ajusta el minmax seg√∫n el tama√±o deseado de la tarjeta */
            gap: 1.5rem; /* Espacio entre tarjetas */
            justify-items: center; /* Centra las tarjetas horizontalmente */
        }

        /* 4 columnas en web (a partir de md breakpoint) */
        @media (min-width: 768px) { /* md breakpoint en Tailwind */
            #genreCardsContainer {
                grid-template-columns: repeat(4, 1fr);
            }
        }

         /* Estilo para el contenedor de recomendaciones usando grid */
        #recommendationsList {
            display: grid;
            /* Siempre 3 columnas, ajustando el tama√±o m√≠nimo */
             grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); /* Ajusta el minmax seg√∫n el tama√±o deseado */
            gap: 1.5rem; /* Espacio entre tarjetas */
            justify-items: center; /* Centra las tarjetas horizontalmente */
        }

         /* Estilo para el header en m√≥vil/tablet */
        @media (max-width: 767px) { /* Antes del md breakpoint */
            header .container {
                flex-direction: column; /* Apila los elementos en columna */
                align-items: center; /* Centra los elementos */
            }
            header nav {
                display: flex; /* Habilitar flexbox para los botones */
                flex-direction: column; /* Apilar botones verticalmente */
                align-items: flex-end; /* Alinear botones a la derecha */
                margin-top: 0.5rem; /* Espacio superior para separar del t√≠tulo */
            }
             header nav button {
                margin-left: 0 !important; /* Eliminar margen izquierdo en m√≥vil */
                margin-bottom: 0.5rem; /* A√±adir espacio inferior entre botones */
             }
             header nav button:last-child {
                 margin-bottom: 0; /* Eliminar margen inferior del √∫ltimo bot√≥n */
             }
        }


    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="bg-white text-gray-800 p-4 shadow-md">
        <div class="container mx-auto max-w-screen-lg flex justify-between items-center"> <h1 class="text-2xl font-bold">Recomendador de libros</h1>
            <nav>
                <button id="showReadListBtn" class="text-red-600 hover:text-red-800 font-semibold py-2 px-4 rounded-md transition duration-150 ease-in-out border border-red-600 hover:border-red-800 bg-transparent">Mi Lista de Le√≠dos</button>
            </nav>
        </div>
    </header>

    <main class="container mx-auto max-w-screen-lg p-4 flex-grow"> <section id="genreSelection" class="mb-8">
            <h2 class="text-3xl font-semibold text-center text-gray-800 mb-6">Selecciona un g√©nero</h2>
            <div id="genreCardsContainer">
                </div>
        </section>

        <section id="recommendations" class="hidden mb-8">
            <h2 id="recommendationsTitle" class="text-3xl font-semibold text-center text-gray-800 mb-6">Recomendaciones de [G√©nero]</h2>
            <div id="recommendationsList">
                </div>
            <div class="text-center mt-6">
                 <button id="backToGenresBtn" class="btn-secondary w-auto px-6 text-red-600 hover:text-red-800 rounded-md transition duration-150 ease-in-out border border-red-600 hover:border-red-800 py-2 px-4">Volver a G√©neros</button>
            </div>
        </section>

         <section id="readListSection" class="hidden mb-8">
            <h2 class="text-3xl font-semibold text-center text-gray-800 mb-6 ">Mis Libros Le√≠dos</h2>
            <div id="readListContent" class="max-w-2xl mx-auto">
                </div> 
             <div class="text-center mt-6 read-list-actions"> <button id="downloadReadListBtn" class="btn-primary w-auto px-6 mr-2 text-red-600 hover:text-red-800 rounded-md transition duration-150 ease-in-out border border-red-600 hover:border-red-800 py-2 px-4">Descargar Lista</button>
                 <button id="printReadListBtn" class="btn-secondary w-auto px-6 mr-2 text-red-600 hover:text-red-800 rounded-md transition duration-150 ease-in-out border border-red-600 hover:border-red-800 py-2 px-4">Imprimir Lista</button>
                 <button id="backFromReadListBtn" class="btn-secondary w-auto px-6 text-red-600 hover:text-red-800 rounded-md transition duration-150 ease-in-out border border-red-600 hover:border-red-800 py-2 px-4">Volver</button>
            </div>
        </section>

         <div id="messageBox" class="fixed bottom-4 right-4 bg-green-500 text-white p-4 rounded-md shadow-lg hidden z-50">
            Libro a√±adido a tu lista de le√≠dos.
        </div>

    </main>

    <footer class="bg-gray-800 text-white text-center p-4 mt-8 shadow-inner">
        <p>&copy; <span id="year"></span> Recomendador de libros. Creado por Franf13.</p>
    </footer>

    <script>
        // --- DATOS ---
        // Filtramos los g√©neros para eliminar los no deseados
        const allGenres = [
            { id: 1, name: "Ciencia Ficci√≥n", emoji: "üöÄ" },
            { id: 2, name: "Fantas√≠a", emoji: "üêâ" },
            { id: 3, name: "Misterio", emoji: "üîç" },
            { id: 4, name: "Thriller", emoji: "üö®" },
            { id: 5, name: "Romance", emoji: "‚ù§Ô∏è" },
            { id: 6, name: "Hist√≥rica", emoji: "üìú" },
            { id: 7, name: "Contempor√°nea", emoji: "üèôÔ∏è" },
            { id: 8, name: "Biograf√≠a", emoji: "üë§" },
            { id: 12, name: "Poes√≠a", emoji: "üñãÔ∏è" },
            { id: 13, name: "Realismo M√°gico", emoji: "ü¶ã" },
            { id: 14, name: "Cl√°sico", emoji: "üèõÔ∏è" },
            { id: 15, name: "Filosof√≠a", emoji: "ü§î" } 
        ];

        // G√©neros permitidos despu√©s de la eliminaci√≥n
        const allowedGenres = ["Ciencia Ficci√≥n", "Fantas√≠a", "Misterio", "Thriller", "Romance", "Hist√≥rica", "Contempor√°nea", "Biograf√≠a", "Poes√≠a", "Realismo M√°gico", "Cl√°sico", "Filosof√≠a"];

        const genres = allGenres.filter(genre => allowedGenres.includes(genre.name));


        const allBooks = 
[
  { id: 1, title: "Dune", author: "Frank Herbert", genre: "Ciencia Ficci√≥n", emoji: "üèúÔ∏è", linkBase: "https://es.wikipedia.org/wiki/Dune", description: "Una epopeya de ciencia ficci√≥n sobre la lucha por un planeta des√©rtico y su recurso m√°s valioso, la especia melange." },
  { id: 2, title: "El Se√±or de los Anillos", author: "J.R.R. Tolkien", genre: "Fantas√≠a", emoji: "üßô", linkBase: "https://es.wikipedia.org/wiki/El_Se%C3%B1or_de_los_Anillos", description: "Un hobbit emprende un peligroso viaje para destruir un anillo m√°gico y salvar la Tierra Media de la oscuridad." },
  { id: 3, title: "El C√≥digo Da Vinci", author: "Dan Brown", genre: "Misterio", emoji: "üìñ", linkBase: "https://es.wikipedia.org/wiki/El_c%C3%B3digo_Da_Vinci", description: "Un simb√≥logo y una cript√≥loga descubren una conspiraci√≥n mientras investigan un asesinato en el Louvre." },
  { id: 4, title: "La Chica del Tren", author: "Paula Hawkins", genre: "Thriller", emoji: "üöÑ", linkBase: "https://es.wikipedia.org/wiki/La_chica_del_tren_(novela)", description: "Una mujer con problemas de alcoholismo cree ser testigo de un crimen mientras viaja en tren, pero su memoria no es fiable." },
  { id: 5, title: "Orgullo y Prejuicio", author: "Jane Austen", genre: "Romance", emoji: "üíñ", linkBase: "https://es.wikipedia.org/wiki/Orgullo_y_prejuicio", description: "La historia de Elizabeth Bennet y el Sr. Darcy, explorando temas de clase, matrimonio y moralidad en la Inglaterra georgiana." },
  { id: 6, title: "Los Pilares de la Tierra", author: "Ken Follett", genre: "Hist√≥rica", emoji: "üèóÔ∏è", linkBase: "https://es.wikipedia.org/wiki/Los_pilares_de_la_Tierra", description: "Una saga ambientada en la Inglaterra del siglo XII, centrada en la construcci√≥n de una catedral y las vidas entrelazadas de sus personajes." },
  { id: 7, title: "Normal People", author: "Sally Rooney", genre: "Contempor√°nea", emoji: "üë•", linkBase: "https://es.wikipedia.org/wiki/Normal_People", description: "La compleja relaci√≥n entre dos j√≥venes, Marianne y Connell, a lo largo de varios a√±os, explorando la intimidad y la comunicaci√≥n." },
  { id: 8, title: "Steve Jobs", author: "Walter Isaacson", genre: "Biograf√≠a", emoji: "üì±", linkBase: "https://es.wikipedia.org/wiki/Steve_Jobs_(libro)", description: "Una biograf√≠a autorizada del cofundador de Apple, basada en numerosas entrevistas con Jobs, su familia, amigos y colegas." },
  { id: 12, title: "Veinte poemas de amor y una canci√≥n desesperada", author: "Pablo Neruda", genre: "Poes√≠a", emoji: " ‚úçÔ∏è", linkBase: "https://es.wikipedia.org/wiki/Veinte_poemas_de_amor_y_una_canci%C3%B3n_desesperada", description: "Una colecci√≥n ic√≥nica de poemas de amor que exploran la pasi√≥n, la melancol√≠a y la naturaleza." },
  { id: 13, title: "Cien a√±os de soledad", author: "Gabriel Garc√≠a M√°rquez", genre: "Realismo M√°gico", emoji: "ü¶ã", linkBase: "https://es.wikipedia.org/wiki/Cien_a%C3%B1os_de_soledad", description: "La saga de la familia Buend√≠a en el pueblo ficticio de Macondo, una obra maestra del realismo m√°gico." },
  { id: 14, title: "1984", author: "George Orwell", genre: "Ciencia Ficci√≥n", emoji: "üëÅÔ∏è", linkBase: "https://es.wikipedia.org/wiki/1984_(novela)", description: "Una distop√≠a sobre un futuro totalitario donde el Gran Hermano vigila todos los aspectos de la vida." },
  { id: 15, title: "Harry Potter y la Piedra Filosofal", author: "J.K. Rowling", genre: "Fantas√≠a", emoji: "‚ö°", linkBase: "https://es.wikipedia.org/wiki/Harry_Potter_y_la_piedra_filosofal", description: "La introducci√≥n al mundo m√°gico de Harry Potter, un ni√±o que descubre que es un mago y asiste a Hogwarts." },
  { id: 16, title: "El Resplandor", author: "Stephen King", genre: "Thriller", emoji: "üè®", linkBase: "https://es.wikipedia.org/wiki/El_resplandor_(novela)", description: "Una familia se muda a un hotel aislado para cuidarlo durante el invierno, pero fuerzas siniestras comienzan a afectar al padre." },
  { id: 17, title: "Crimen y Castigo", author: "Fyodor Dostoevsky", genre: "Misterio", emoji: "üî™", linkBase: "https://es.wikipedia.org/wiki/Crimen_y_castigo", description: "Un estudiante pobre comete un asesinato y lucha con su culpa y las consecuencias psicol√≥gicas de sus actos." },
  { id: 18, title: "Antes de ti", author: "Jojo Moyes", genre: "Romance", emoji: "‚ôø", linkBase: "https://es.wikipedia.org/wiki/Antes_de_ti", description: "La historia de una joven que se convierte en cuidadora de un hombre rico que qued√≥ tetrapl√©jico tras un accidente." },
  { id: 19, title: "La Sombra del Viento", author: "Carlos Ruiz Zaf√≥n", genre: "Misterio", emoji: "üëª", linkBase: "https://es.wikipedia.org/wiki/La_sombra_del_viento", description: "Un joven descubre un libro misterioso en el Cementerio de los Libros Olvidados y se ve envuelto en una intriga oscura." },
  { id: 20, title: "Sapiens: De animales a dioses", author: "Yuval Noah Harari", genre: "Hist√≥rica", emoji: "üêí", linkBase: "https://es.wikipedia.org/wiki/Sapiens:_De_animales_a_dioses", description: "Una breve historia de la humanidad, explorando c√≥mo Homo sapiens lleg√≥ a dominar el planeta." },
  { id: 21, title: "El Principito", author: "Antoine de Saint-Exup√©ry", genre: "Fantas√≠a", emoji: " ü¶ä", linkBase: "https://es.wikipedia.org/wiki/El_principito", description: "Un piloto estrellado en el desierto conoce a un peque√±o pr√≠ncipe de otro planeta, aprendiendo lecciones sobre la vida y el amor." },
  { id: 22, title: "Fundaci√≥n", author: "Isaac Asimov", genre: "Ciencia Ficci√≥n", emoji: "üåå", linkBase: "https://es.wikipedia.org/wiki/Fundaci%C3%B3n_(novela)", description: "Un cient√≠fico predice la ca√≠da del Imperio Gal√°ctico y crea una fundaci√≥n para preservar el conocimiento y acortar la era oscura." },
  { id: 23, title: "Don Quijote de la Mancha", author: "Miguel de Cervantes", genre: "Cl√°sico", emoji: "üêé", linkBase: "https://es.wikipedia.org/wiki/Don_Quijote_de_la_Mancha", description: "Las aventuras de un hidalgo que enloquece leyendo libros de caballer√≠as y decide convertirse en caballero andante." },
  { id: 26, title: "Meditaciones", author: "Marco Aurelio", genre: "Filosof√≠a", emoji: "ü§î", linkBase: "https://es.wikipedia.org/wiki/Meditaciones", description: "Una serie de reflexiones personales del emperador romano Marco Aurelio sobre la filosof√≠a estoica." },
  { id: 27, title: "El arte de la guerra", author: "Sun Tzu", genre: "Hist√≥rica", emoji: "‚öîÔ∏è", linkBase: "https://es.wikipedia.org/wiki/El_arte_de_la_guerra", description: "Un antiguo tratado militar chino que ofrece estrategias y t√°cticas para la guerra y la gesti√≥n de conflictos." },
  { id: 28, title: "El retrato de Dorian Gray", author: "Oscar Wilde", genre: "Cl√°sico", emoji: "üñºÔ∏è", linkBase: "https://es.wikipedia.org/wiki/El_retrato_de_Dorian_Gray", description: "Un joven vende su alma para que un retrato envejezca en su lugar, mientras √©l conserva su juventud y belleza." },
  { id: 29, title: "Fahrenheit 451", author: "Ray Bradbury", genre: "Ciencia Ficci√≥n", emoji: "üî•", linkBase: "https://es.wikipedia.org/wiki/Fahrenheit_451", description: "En un futuro dist√≥pico, los bomberos queman libros en lugar de apagar incendios, y un bombero cuestiona su papel." },
  { id: 30, title: "La Odisea", author: "Homero", genre: "Cl√°sico", emoji: "üö¢", linkBase: "https://es.wikipedia.org/wiki/Odisea", description: "El √©pico viaje de Odiseo de regreso a casa despu√©s de la Guerra de Troya, enfrentando monstruos y desaf√≠os." },
  { id: 31, title: "Un Mundo Feliz", author: "Aldous Huxley", genre: "Ciencia Ficci√≥n", emoji: "üíä", linkBase: "https://es.wikipedia.org/wiki/Un_mundo_feliz", description: "Una sociedad futurista controlada por la tecnolog√≠a, la ingenier√≠a gen√©tica y la manipulaci√≥n psicol√≥gica." },
  { id: 32, title: "El Nombre del Viento", author: "Patrick Rothfuss", genre: "Fantas√≠a", emoji: "üå¨Ô∏è", linkBase: "https://es.wikipedia.org/wiki/El_nombre_del_viento", description: "La historia de Kvothe, un legendario m√∫sico, asesino y mago, contada por √©l mismo." },
  { id: 33, title: "La Verdad Sobre el Caso Harry Quebert", author: "Jo√´l Dicker", genre: "Misterio", emoji: "‚úçÔ∏è", linkBase: "https://es.wikipedia.org/wiki/La_verdad_sobre_el_caso_Harry_Quebert", description: "Un joven escritor investiga el asesinato de una chica desaparecida a√±os atr√°s, en el que su mentor es el principal sospechoso." },
  { id: 34, title: "Perdida", author: "Gillian Flynn", genre: "Thriller", emoji: " ‚ôÄÔ∏è", linkBase: "https://es.wikipedia.org/wiki/Perdida_(novela)", description: "La desaparici√≥n de una mujer en su quinto aniversario de bodas y el escrutinio medi√°tico sobre su marido." },
  { id: 35, title: "El Diario de Bridget Jones", author: "Helen Fielding", genre: "Romance", emoji: "‚úçÔ∏è", linkBase: "https://es.wikipedia.org/wiki/El_diario_de_Bridget_Jones", description: "Las divertidas y a menudo desastrosas entradas del diario de una treinta√±era soltera en Londres." },
  { id: 36, title: "La Ladrona de Libros", author: "Markus Zusak", genre: "Hist√≥rica", emoji: "üìö", linkBase: "https://es.wikipedia.org/wiki/La_ladrona_de_libros", description: "La historia de una ni√±a en la Alemania nazi que encuentra consuelo robando libros, narrada por la Muerte." },
  { id: 37, title: "Eleanor Oliphant Est√° Perfectamente", author: "Gail Honeyman", genre: "Contempor√°nea", emoji: "üåµ", linkBase: "https://es.wikipedia.org/wiki/Eleanor_Oliphant_Is_Completely_Fine", description: "La vida solitaria y peculiar de Eleanor Oliphant cambia inesperadamente tras un encuentro fortuito." },
  { id: 38, title: "Open: An Autobiography", author: "Andre Agassi", genre: "Biograf√≠a", emoji: "üéæ", linkBase: "https://es.wikipedia.org/wiki/Open_(libro)", description: "La sincera y reveladora autobiograf√≠a del legendario tenista Andre Agassi." },
  { id: 39, title: "Poeta en Nueva York", author: "Federico Garc√≠a Lorca", genre: "Poes√≠a", emoji: "üóΩ", linkBase: "https://es.wikipedia.org/wiki/Poeta_en_Nueva_York", description: "Una colecci√≥n de poemas escritos por Lorca durante su estancia en Nueva York, marcada por la angustia y la cr√≠tica social." },
  { id: 40, title: "Pedro P√°ramo", author: "Juan Rulfo", genre: "Realismo M√°gico", emoji: "üíÄ", linkBase: "https://es.wikipedia.org/wiki/Pedro_P%C3%A1ramo", description: "Un hombre busca a su padre en un pueblo fantasma habitado por las voces de los muertos." },
  { id: 41, title: "La Rep√∫blica", author: "Plat√≥n", genre: "Filosof√≠a", emoji: "üèõÔ∏è", linkBase: "https://es.wikipedia.org/wiki/La_Rep%C3%BAblica_(Plat%C3%B3n)", description: "Un di√°logo socr√°tico que explora la justicia, el orden de la ciudad-estado ideal y el alma justa." },
  { id: 42, title: "Hamlet", author: "William Shakespeare", genre: "Cl√°sico", emoji: "üëë", linkBase: "https://es.wikipedia.org/wiki/Hamlet", description: "La tragedia del Pr√≠ncipe Hamlet de Dinamarca, quien busca vengar el asesinato de su padre." },
  { id: 43, title: "Flores para Algernon", author: "Daniel Keyes", genre: "Ciencia Ficci√≥n", emoji: "üß†", linkBase: "https://es.wikipedia.org/wiki/Flores_para_Algernon", description: "Un hombre con discapacidad intelectual se somete a un experimento para aumentar su inteligencia, con resultados inesperados." },
  { id: 44, title: "El Hobbit", author: "J.R.R. Tolkien", genre: "Fantas√≠a", emoji: " üèûÔ∏è", linkBase: "https://es.wikipedia.org/wiki/El_Hobbit", description: "La aventura de Bilbo Bols√≥n, un hobbit que se une a un grupo de enanos para recuperar un tesoro custodiado por un drag√≥n." },
  { id: 45, title: "El Sabueso de los Baskerville", author: "Arthur Conan Doyle", genre: "Misterio", emoji: " üêï", linkBase: "https://es.wikipedia.org/wiki/El_sabueso_de_los_Baskerville", description: "Sherlock Holmes investiga una supuesta maldici√≥n familiar y un sabueso fantasmal en los p√°ramos de Dartmoor." },
  { id: 46, title: "El Silencio de los Corderos", author: "Thomas Harris", genre: "Thriller", emoji: " üêë", linkBase: "https://es.wikipedia.org/wiki/El_silencio_de_los_corderos_(novela)", description: "Una joven agente del FBI busca la ayuda de un brillante y peligroso can√≠bal para atrapar a un asesino en serie." },
  { id: 47, title: "Cumbres Borrascosas", author: "Emily Bront√´", genre: "Romance", emoji: " üíî", linkBase: "https://es.wikipedia.org/wiki/Cumbres_Borrascosas", description: "Una intensa y oscura historia de amor y venganza en los p√°ramos de Yorkshire." },
  { id: 48, title: "Soldados de Salamina", author: "Javier Cercas", genre: "Hist√≥rica", emoji: " üïäÔ∏è", linkBase: "https://es.wikipedia.org/wiki/Soldados_de_Salamina", description: "Un periodista investiga la historia de un escritor falangista que fue perdonado durante la Guerra Civil Espa√±ola." },
  { id: 49, title: "Patria", author: "Fernando Aramburu", genre: "Contempor√°nea", emoji: " üèòÔ∏è", linkBase: "https://es.wikipedia.org/wiki/Patria_(novela)", description: "Las vidas de dos familias vascas afectadas por la violencia de ETA a lo largo de varias d√©cadas." },
  { id: 50, title: "Frida Kahlo: Una Biograf√≠a", author: "Hayden Herrera", genre: "Biograf√≠a", emoji: " üå∫", linkBase: "https://www.penguinlibros.com/es/biografias/12338-frida-kahlo-9788437607018", description: "Una biograf√≠a detallada y conmovedora de la ic√≥nica pintora mexicana Frida Kahlo." },
  { id: 51, title: "Las Flores del Mal", author: "Charles Baudelaire", genre: "Poes√≠a", emoji: " ü•Ä", linkBase: "https://es.wikipedia.org/wiki/Las_flores_del_mal", description: "Una obra cumbre de la poes√≠a simbolista, explorando la belleza en lo decadente y lo prohibido." },
  { id: 52, title: "El Amor en los Tiempos del C√≥lera", author: "Gabriel Garc√≠a M√°rquez", genre: "Realismo M√°gico", emoji: " üíò", linkBase: "https://es.wikipedia.org/wiki/El_amor_en_los_tiempos_del_c%C3%B3lera", description: "Una historia √©pica de un amor que perdura por m√°s de cincuenta a√±os, a trav√©s de separaciones y enfermedades." },
  { id: 53, title: "As√≠ Habl√≥ Zaratustra", author: "Friedrich Nietzsche", genre: "Filosof√≠a", emoji: " ‚õ∞Ô∏è", linkBase: "https://es.wikipedia.org/wiki/As%C3%AD_habl%C3%B3_Zaratustra", description: "Una obra filos√≥fica y po√©tica que presenta las ideas de Nietzsche a trav√©s del personaje de Zaratustra." },
  { id: 54, title: "Orgullo y Prejuicio", author: "Jane Austen", genre: "Cl√°sico", emoji: " üëë", linkBase: "https://es.wikipedia.org/wiki/Orgullo_y_prejuicio", description: "La historia de Elizabeth Bennet y el Sr. Darcy, explorando temas de clase, matrimonio y moralidad en la Inglaterra georgiana." },
  { id: 55, title: "Neuromante", author: "William Gibson", genre: "Ciencia Ficci√≥n", emoji: " üíª", linkBase: "https://es.wikipedia.org/wiki/Neuromante", description: "Considerada una obra fundacional del cyberpunk, sigue a un hacker contratado para una √∫ltima misi√≥n." },
  { id: 56, title: "El Nombre del Viento", author: "Patrick Rothfuss", genre: "Fantas√≠a", emoji: " üé∂", linkBase: "https://es.wikipedia.org/wiki/El_nombre_del_viento", description: "La historia de Kvothe, un legendario m√∫sico, asesino y mago, contada por √©l mismo." },
  { id: 57, title: "La Caza del Octubre Rojo", author: "Tom Clancy", genre: "Thriller", emoji: "‚öì", linkBase: "https://es.wikipedia.org/wiki/La_caza_del_Octubre_Rojo_(novela)", description: "Un submarino nuclear sovi√©tico de √∫ltima generaci√≥n se dirige hacia la costa de EE.UU., y un analista de la CIA debe determinar si es una deserci√≥n o un ataque." },
  { id: 58, title: "El Gran Gatsby", author: "F. Scott Fitzgerald", genre: "Cl√°sico", emoji: " ü•Ç", linkBase: "https://es.wikipedia.org/wiki/El_gran_Gatsby", description: "La historia de Jay Gatsby, un misterioso millonario, y su obsesi√≥n por recuperar un amor del pasado en la d√©cada de 1920." },
  { id: 59, title: "Ficciones", author: "Jorge Luis Borges", genre: "Realismo M√°gico", emoji: "üìö", linkBase: "https://es.wikipedia.org/wiki/Ficciones", description: "Una colecci√≥n de cuentos que exploran temas filos√≥ficos y metaf√≠sicos a trav√©s de laberintos, bibliotecas infinitas y realidades alternativas." },
  { id: 60, title: "M√°s all√° del bien y del mal", author: "Friedrich Nietzsche", genre: "Filosof√≠a", emoji: " ü§î", linkBase: "https://es.wikipedia.org/wiki/M%C3%A1s_all%C3%A1_del_bien_y_del_mal", description: "Una cr√≠tica a la moral tradicional y una exploraci√≥n de nuevas perspectivas filos√≥ficas." },
  { id: 61, title: "El Le√≥n, la Bruja y el Armario", author: "C.S. Lewis", genre: "Fantas√≠a", emoji: " ü¶Å", linkBase: "https://es.wikipedia.org/wiki/El_le%C3%B3n,_la_bruja_y_el_armario", description: "Cuatro hermanos descubren un mundo m√°gico a trav√©s de un armario, donde deben ayudar a derrotar a una bruja malvada." },
  { id: 62, title: "El Imperio Final (Nacidos de la Bruma #1)", author: "Brandon Sanderson", genre: "Fantas√≠a", emoji: " üå´Ô∏è", linkBase: "https://es.wikipedia.org/wiki/El_imperio_final", description: "En un mundo cubierto por ceniza, un grupo de rebeldes planea derrocar al tir√°nico Lord Legislador, poseedor de poderes divinos." },
  { id: 63, title: "Asesinato en el Orient Express", author: "Agatha Christie", genre: "Misterio", emoji: " üöÇ", linkBase: "https://es.wikipedia.org/wiki/Asesinato_en_el_Orient_Express", description: "H√©rcules Poirot debe resolver el asesinato de un pasajero a bordo del famoso tren Orient Express, varado por la nieve." },
  { id: 64, title: "El Nombre de la Rosa", author: "Umberto Eco", genre: "Misterio", emoji: " üìñ", linkBase: "https://es.wikipedia.org/wiki/El_nombre_de_la_rosa", description: "Un monje franciscano y su novicio investigan una serie de misteriosas muertes en una abad√≠a benedictina en el siglo XIV." },
  { id: 65, title: "El Psicoanalista", author: "John Katzenbach", genre: "Thriller", emoji: " ü§î", linkBase: "https://es.wikipedia.org/wiki/El_psicoanalista", description: "Un psicoanalista recibe una carta an√≥nima que lo obliga a descubrir la identidad de alguien que busca destruir su vida, o uno de sus seres queridos morir√°." },
  { id: 66, title: "El Cuaderno de Noah", author: "Nicholas Sparks", genre: "Romance", emoji: " üíå", linkBase: "https://es.wikipedia.org/wiki/The_Notebook_(novela)", description: "La conmovedora historia de un amor de verano que perdura a trav√©s de los a√±os, narrada desde un hogar de ancianos." },
  { id: 67, title: "Bajo la Misma Estrella", author: "John Green", genre: "Romance", emoji: " ‚ú®", linkBase: "https://es.wikipedia.org/wiki/The_Fault_in_Our_Stars", description: "La historia de amor entre dos adolescentes, Hazel y Gus, que se conocen en un grupo de apoyo para pacientes con c√°ncer." },
  { id: 68, title: "El M√©dico", author: "Noah Gordon", genre: "Hist√≥rica", emoji: " ü©∫", linkBase: "https://es.wikipedia.org/wiki/El_m%C3%A9dico_(novela)", description: "La vida de Rob J. Cole, un hu√©rfano ingl√©s que viaja a Persia en el siglo XI para estudiar medicina con un legendario maestro." },
  { id: 69, title: "El Jilguero", author: "Donna Tartt", genre: "Contempor√°nea", emoji: " üé®", linkBase: "https://es.wikipedia.org/wiki/El_jilguero_(novela)", description: "La vida de Theo Decker despu√©s de que un atentado en un museo de Nueva York cambie su vida para siempre, involucr√°ndolo en el mundo del arte y el crimen." },
  { id: 70, title: "Peque√±os Fuegos por Todas Partes", author: "Celeste Ng", genre: "Contempor√°nea", emoji: " üî•", linkBase: "https://es.wikipedia.org/wiki/Little_Fires_Everywhere_(novela)", description: "Las vidas de dos familias en Shaker Heights, un suburbio aparentemente perfecto, se entrelazan con consecuencias inesperadas." },
  { id: 71, title: "Leonardo da Vinci", author: "Walter Isaacson", genre: "Biograf√≠a", emoji: " üñåÔ∏è", linkBase: "https://es.wikipedia.org/wiki/Leonardo_da_Vinci_(libro_de_Walter_Isaacson)", description: "Una biograf√≠a del genio renacentista, basada en miles de p√°ginas de sus cuadernos, que revela la conexi√≥n entre su arte y su ciencia." },
  { id: 72, title: "Campos de Castilla", author: "Antonio Machado", genre: "Poes√≠a", emoji: " üåæ", linkBase: "https://es.wikipedia.org/wiki/Campos_de_Castilla", description: "Una colecci√≥n de poemas que retratan el paisaje castellano y reflexionan sobre Espa√±a, el tiempo y la existencia." },
  { id: 73, title: "Como Agua para Chocolate", author: "Laura Esquivel", genre: "Realismo M√°gico", emoji: " üå∂Ô∏è", linkBase: "https://es.wikipedia.org/wiki/Como_agua_para_chocolate", description: "La historia de Tita, cuyas emociones se manifiestan en su cocina, afectando a quienes prueban sus platillos, en el M√©xico posrevolucionario." },
  { id: 74, title: "Moby Dick", author: "Herman Melville", genre: "Cl√°sico", emoji: " üê≥", linkBase: "https://es.wikipedia.org/wiki/Moby_Dick", description: "La obsesiva b√∫squeda del Capit√°n Ahab por la ballena blanca Moby Dick, una √©pica reflexi√≥n sobre la venganza, la naturaleza y la locura." },
  { id: 75, title: "El Pr√≠ncipe", author: "Nicol√°s Maquiavelo", genre: "Filosof√≠a", emoji: " üëë", linkBase: "https://es.wikipedia.org/wiki/El_pr%C3%ADncipe", description: "Un tratado pol√≠tico del siglo XVI que describe los m√©todos por los cuales un pr√≠ncipe puede adquirir y mantener el poder pol√≠tico." }
]

        // Filtramos los libros para que solo incluyan los de los g√©neros permitidos
        const books = allBooks.filter(book => allowedGenres.includes(book.genre));


        let readBooks = []; // Array para almacenar los IDs de los libros le√≠dos
        let currentGenreBooks = []; // Libros del g√©nero actualmente mostrado
        let displayedBookIds = new Set(); // IDs de los libros actualmente mostrados en recomendaciones


        // --- ELEMENTOS DEL DOM ---
        const genreSelectionSection = document.getElementById('genreSelection');
        const genreCardsContainer = document.getElementById('genreCardsContainer'); // Contenedor para las tarjetas
        const recommendationsSection = document.getElementById('recommendations');
        const recommendationsTitle = document.getElementById('recommendationsTitle');
        const recommendationsList = document.getElementById('recommendationsList');
        const readListSection = document.getElementById('readListSection');
        const readListContent = document.getElementById('readListContent');
        // const showGenreSelectionBtn = document.getElementById('showGenreSelectionBtn'); // Eliminado del HTML
        const showReadListBtn = document.getElementById('showReadListBtn');
        const backToGenresBtn = document.getElementById('backToGenresBtn');
        const backFromReadListBtn = document.getElementById('backFromReadListBtn');
        const downloadReadListBtn = document.getElementById('downloadReadListBtn');
        const printReadListBtn = document.getElementById('printReadListBtn'); // Bot√≥n de imprimir
        const yearSpan = document.getElementById('year');
        const messageBox = document.getElementById('messageBox');


        // --- FUNCIONES DE NAVEGACI√ìN ---
        function showGenreSelection() {
            genreSelectionSection.classList.remove('hidden');
            recommendationsSection.classList.add('hidden');
            readListSection.classList.add('hidden');
             // Limpiar recomendaciones y IDs mostrados al volver a g√©neros
            recommendationsList.innerHTML = '';
            displayedBookIds.clear();
        }

        function showRecommendations(genreName) {
            genreSelectionSection.classList.add('hidden');
            recommendationsSection.classList.remove('hidden');
            readListSection.classList.add('hidden');
            recommendationsTitle.textContent = `Recomendaciones de ${genreName}`;
            displayRecommendations(genreName);
        }

         function showReadList() {
            genreSelectionSection.classList.add('hidden');
            recommendationsSection.classList.add('hidden');
            readListSection.classList.remove('hidden');
            renderReadList(); // Renderiza la lista cada vez que se muestra
        }


        // --- FUNCIONES DE DATOS Y RENDERIZADO ---

        // Funci√≥n para encontrar un libro por su ID
        function findBookById(id) {
            return books.find(book => book.id === id) || null;
        }

        // Guarda la lista de le√≠dos en localStorage
        function saveReadList() {
            localStorage.setItem('readBooks', JSON.stringify(readBooks));
        }

        // Carga la lista de le√≠dos de localStorage
        function loadReadList() {
            const storedList = localStorage.getItem('readBooks');
            if (storedList) {
                readBooks = JSON.parse(storedList);
            }
        }

        // Muestra un mensaje temporal
        function showMessage(message, isError = false) {
            messageBox.textContent = message;
            if (isError) {
                messageBox.classList.remove('bg-green-500');
                messageBox.classList.add('bg-red-500');
            } else {
                 messageBox.classList.remove('bg-red-500');
                messageBox.classList.add('bg-green-500');
            }
            messageBox.classList.remove('hidden');
            // Ocultar despu√©s de 3 segundos
            setTimeout(() => {
                messageBox.classList.add('hidden');
            }, 3000);
        }

        // Crea las tarjetas de g√©nero
        function createGenreButtons() {
            genreCardsContainer.innerHTML = ''; // Limpiar contenedor antes de a√±adir
            genres.forEach(genre => {
                // Crear el elemento div que actuar√° como tarjeta
                const card = document.createElement('div');
                card.classList.add('genre-card', 'shadow-md', 'rounded-lg', 'bg-white', 'items-center', 'text-center', 'bg-white', 'p-4', 'items-center'); // Aplicar clases de estilo de tarjeta
                card.dataset.genre = genre.name; // Guardar el nombre del g√©nero en un atributo de datos

                // Contenido de la tarjeta
                card.innerHTML = `
                    <div class="genre-emoji">${genre.emoji}</div>
                    <h3 class="text-xl font-semibold text-gray-700">${genre.name}</h3>
                `;

                // A√±adir evento click a la tarjeta
                card.addEventListener('click', () => {
                    showRecommendations(genre.name);
                });

                // A√±adir la tarjeta al contenedor
                genreCardsContainer.appendChild(card);
            });
        }

        // Obtiene N recomendaciones aleatorias no le√≠das para un g√©nero
        function getRandomRecommendations(genreName, count) {
            const availableBooks = books.filter(book =>
                book.genre === genreName &&
                !readBooks.includes(book.id) && // No le√≠dos
                !displayedBookIds.has(book.id) // No mostrados actualmente
            );

            // Mezclar los libros disponibles
            for (let i = availableBooks.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [availableBooks[i], availableBooks[j]] = [availableBooks[j], availableBooks[i]]; // Intercambio
            }

            // Devolver los primeros 'count' libros (o menos si no hay suficientes)
            return availableBooks.slice(0, count);
        }


        // Muestra las recomendaciones para un g√©nero
        function displayRecommendations(genreName) {
            recommendationsList.innerHTML = ''; // Limpiar lista antes de a√±adir
            displayedBookIds.clear(); // Limpiar IDs mostrados al cambiar de g√©nero

            // Obtener todos los libros de este g√©nero (para referencia)
            currentGenreBooks = books.filter(book => book.genre === genreName);

            // Obtener las 3 recomendaciones iniciales
            const initialRecommendations = getRandomRecommendations(genreName, 3);

            if (initialRecommendations.length === 0) {
                recommendationsList.innerHTML = '<p class="text-center text-gray-600 col-span-full">No hay recomendaciones disponibles para este g√©nero.</p>';
                return;
            }

            initialRecommendations.forEach(book => {
                addBookToRecommendationsList(book);
            });
        }

        // A√±ade un libro a la lista de recomendaciones mostrada
        function addBookToRecommendationsList(book) {
             const bookElement = document.createElement('div');
                // Aplicar clases de estilo de tarjeta de libro
                bookElement.classList.add('book-card', 'shadow-md', 'rounded-lg', 'p-4', 'bg-white', 'flex', 'flex-col', 'items-center', 'text-center'); // Aseguramos centrado
                bookElement.dataset.bookId = book.id; // A√±adir data-book-id para f√°cil referencia

                // Usar la descripci√≥n completa ya que se elimin√≥ el l√≠mite de caracteres en CSS
                const description = book.description || 'Sin descripci√≥n disponible.';


                bookElement.innerHTML = `
                    <div class="recommendation-emoji">${book.emoji}</div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-1">${book.title}</h3>
                    <p class="text-gray-600 text-sm mb-2">por ${book.author}</p>
                    <p class="book-description">${description}</p> <a href="${book.linkBase}" target="_blank" class="text-red-600 hover:underline text-sm mb-4">M√°s Informaci√≥n</a>
                    <button class="btn-secondary text-red-600 hover:text-red-800 rounded-md transition duration-150 ease-in-out border border-red-600 hover:border-red-800 py-1 px-2" data-book-id="${book.id}">Marcar como le√≠do</button> `;

                // A√±adir evento click al bot√≥n "Marcar como Le√≠do"
                const markAsReadBtn = bookElement.querySelector('button');
                markAsReadBtn.addEventListener('click', handleMarkAsRead); // Usar una funci√≥n separada

                recommendationsList.appendChild(bookElement);
                displayedBookIds.add(book.id); // A√±adir a los IDs mostrados
        }

        // Maneja el evento de marcar como le√≠do
        function handleMarkAsRead(event) {
            const bookId = parseInt(event.target.dataset.bookId);
            const bookElement = event.target.closest('.book-card'); // Encontrar el elemento de la tarjeta

            if (!readBooks.includes(bookId)) {
                readBooks.push(bookId);
                saveReadList();
                const book = findBookById(bookId);
                if (book) {
                     showMessage(`"${book.title}" a√±adido a tu lista de le√≠dos.`);
                }


                // 1. Eliminar el libro de la vista de recomendaciones
                if (bookElement) {
                    bookElement.remove();
                    displayedBookIds.delete(bookId); // Eliminar de los IDs mostrados
                }

                // 2. A√±adir una nueva recomendaci√≥n aleatoria (si hay disponibles)
                const currentGenreName = recommendationsTitle.textContent.replace('Recomendaciones de ', '');
                const newRecommendations = getRandomRecommendations(currentGenreName, 1); // Obtener 1 nueva recomendaci√≥n

                if (newRecommendations.length > 0) {
                    addBookToRecommendationsList(newRecommendations[0]); // A√±adir la nueva recomendaci√≥n
                } else {
                    // Si no hay m√°s recomendaciones disponibles para este g√©nero
                    if (recommendationsList.children.length === 0) {
                         recommendationsList.innerHTML = '<p class="text-center text-gray-600 col-span-full">No hay m√°s recomendaciones disponibles para este g√©nero.</p>';
                    } else {
                         // Opcional: Mostrar un mensaje si no se puede reemplazar
                         // showMessage("No hay m√°s libros sin leer en este g√©nero para a√±adir.", true);
                    }
                }

                 renderReadList(); // Actualizar la lista de le√≠dos mostrada si est√° visible
            }
        }


        // Renderiza la lista de libros le√≠dos
        function renderReadList() {
            readListContent.innerHTML = ''; // Limpiar lista antes de a√±adir

            if (readBooks.length === 0) {
                readListContent.innerHTML = '<p class="text-center text-gray-600">Tu lista de libros le√≠dos est√° vac√≠a.</p>';
                return;
            }

            // Obtener detalles de los libros le√≠dos y ordenarlos alfab√©ticamente
            const readBooksDetails = readBooks.map(id => findBookById(id)).filter(book => book !== null);
            readBooksDetails.sort((a,b) => a.title.localeCompare(b.title));


            readBooksDetails.forEach(book => {
                const listItem = document.createElement('div');
                listItem.classList.add('read-list-item');
                listItem.innerHTML = `
                    <span>${book.title} por ${book.author}</span>
                    <button class="text-red-600 hover:text-red-800 text-sm font-semibold" data-book-id="${book.id}">Eliminar</button>
                `;

                // A√±adir evento click al bot√≥n "Eliminar"
                const deleteBtn = listItem.querySelector('button');
                deleteBtn.addEventListener('click', () => {
                    readBooks = readBooks.filter(id => id !== book.id);
                    saveReadList();
                    showMessage(`"${book.title}" eliminado de tu lista de le√≠dos.`);
                    renderReadList(); // Volver a renderizar la lista despu√©s de eliminar
                    // Opcional: Si est√°s en la vista de recomendaciones, actualizar el bot√≥n correspondiente
                    const recBtn = recommendationsList.querySelector(`button[data-book-id="${book.id}"]`);
                    if(recBtn) {
                        recBtn.textContent = 'Marcar como le√≠do';
                        recBtn.classList.remove('btn-secondary');
                        recBtn.classList.add('btn-primary');
                        recBtn.disabled = false;
                    }
                });

                readListContent.appendChild(listItem);
            });
        }

        // Funci√≥n para descargar la lista de le√≠dos como JSON
        function downloadReadList() {
             if (readBooks.length === 0) {
                showMessage("Tu lista de libros le√≠dos est√° vac√≠a.", true); // Mensaje de error
                return;
            }
            const readBooksDetails = readBooks.map(id => findBookById(id)).filter(book => book !== null);
            // Ordenar alfab√©ticamente para la descarga
            readBooksDetails.sort((a,b) => a.title.localeCompare(b.title));

            // Excluir 'linkBase' si no quieres descargarlo
             const dataToDownload = readBooksDetails.map(({ linkBase, ...rest }) => rest);

            const dataStr = JSON.stringify(dataToDownload, null, 2); // Pretty print JSON
            const dataBlob = new Blob([dataStr], { type: 'application/json;charset=utf-8' }); // Especificar charset
            const url = URL.createObjectURL(dataBlob);

            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.href = url;
            downloadAnchorNode.download = "mis_libros_leidos.json"; // Nombre archivo
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
            URL.revokeObjectURL(url); // Limpiar el objeto URL
             showMessage("Lista descargada correctamente.");
        }

        // Funci√≥n para imprimir la lista de le√≠dos
        function printReadList() {
             if (readBooks.length === 0) {
                showMessage("Tu lista de libros le√≠dos est√° vac√≠a.", true); // Mensaje de error
                return;
            }
            // Abre la ventana de impresi√≥n del navegador
            window.print();
        }


        // --- EVENT LISTENERS ---
        // showGenreSelectionBtn.addEventListener('click', showGenreSelection); // Eliminado del HTML y JS
        showReadListBtn.addEventListener('click', showReadList);
        backToGenresBtn.addEventListener('click', showGenreSelection);
        backFromReadListBtn.addEventListener('click', showGenreSelection); // Volver a g√©neros desde la lista de le√≠dos
        downloadReadListBtn.addEventListener('click', downloadReadList);
        printReadListBtn.addEventListener('click', printReadList); // Event listener para imprimir


        // --- INICIALIZACI√ìN ---
        document.addEventListener('DOMContentLoaded', () => {
            yearSpan.textContent = new Date().getFullYear(); // Poner a√±o actual en footer
            loadReadList(); // Cargar lista de le√≠dos al inicio
            createGenreButtons(); // Crear las tarjetas de g√©nero al cargar
            renderReadList(); // Renderizar la lista de le√≠dos al cargar (aunque est√© oculta)
            showGenreSelection(); // Mostrar la secci√≥n de selecci√≥n de g√©nero por defecto
        });

    </script>

</body>
</html>